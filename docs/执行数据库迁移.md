# 执行数据库迁移

## 问题说明

当前后端返回500错误，原因是数据库表尚未创建。需要执行以下迁移脚本：

## 执行步骤

### 1. 创建课程问答表

```bash
# 方法1：直接执行SQL文件
psql -U postgres -d smartlearning -f backend/migrations/create_course_qa_tables.sql

# 方法2：如果使用Docker
docker exec -i your_postgres_container psql -U postgres -d smartlearning < backend/migrations/create_course_qa_tables.sql

# 方法3：如果数据库名不同，请替换 smartlearning 为实际的数据库名
```

### 2. 创建LLM调用日志表（可选，但推荐）

```bash
psql -U postgres -d smartlearning -f backend/migrations/create_llm_call_log_table.sql
```

## 验证表是否创建成功

执行以下SQL查询验证：

```sql
-- 连接到数据库
psql -U postgres -d smartlearning

-- 检查表是否存在
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('course_qa_session', 'course_qa_message', 'llm_call_log');

-- 检查表结构
\d course_qa_session
\d course_qa_message
\d llm_call_log
```

## 如果执行失败

1. **检查数据库连接**
   ```bash
   psql -U postgres -d smartlearning -c "SELECT version();"
   ```

2. **检查文件路径**
   确保 `backend/migrations/create_course_qa_tables.sql` 文件存在

3. **检查权限**
   确保postgres用户有创建表的权限

4. **查看详细错误**
   执行迁移时如果出错，会显示详细的错误信息，根据错误信息进行修复

## 执行后

执行迁移后，重启后端服务，然后刷新前端页面测试功能。
