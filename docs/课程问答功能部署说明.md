# 课程问答功能部署说明

## 数据库迁移

在启动功能前，需要先执行数据库迁移脚本创建相关表：

```bash
# 方法1：使用psql命令行
psql -U postgres -d smartlearning -f backend/migrations/create_course_qa_tables.sql

# 方法2：如果使用Docker
docker exec -i your_postgres_container psql -U postgres -d smartlearning < backend/migrations/create_course_qa_tables.sql
```

## 验证表是否创建成功

执行以下SQL查询验证：

```sql
-- 检查表是否存在
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('course_qa_session', 'course_qa_message');

-- 检查表结构
\d course_qa_session
\d course_qa_message
```

## 功能说明

### 学生端功能
- 点击右下角浮动按钮打开聊天窗口
- 输入问题后，AI会自动基于课程信息回答
- 可以选择将AI回复发送给相关教师
- 支持多轮对话

### 教师端功能
- 可以查看学生发送的消息
- 可以回复学生的消息
- 可以标记消息为已读

## 故障排查

### 如果遇到500错误

1. **检查数据库表是否存在**
   ```sql
   SELECT * FROM course_qa_session LIMIT 1;
   ```

2. **检查后端日志**
   查看后端控制台输出的详细错误信息

3. **确认LLM配置**
   确保系统已配置并启用了LLM服务（用于AI回答）

4. **检查用户权限**
   确保当前用户角色为'student'（学生端）或'teacher'（教师端）
